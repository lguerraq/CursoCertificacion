function GetUUIDv4(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(n){var t=Math.random()*16|0,i=n=="x"?t:t&3|8;return i.toString(16)})}var contenidoHtml="",respuestas=[],respuestasTrueFalse=[],respuestasMulti=[];respuestasTrueFalse.push({RowId:GetUUIDv4(),IdRespuesta:0,Descripcion:"VERDADERO",Selected:!0});respuestasTrueFalse.push({RowId:GetUUIDv4(),IdRespuesta:0,Descripcion:"FALSO",Selected:!1});respuestasMulti.push({RowId:GetUUIDv4(),IdRespuesta:0,Descripcion:"OPCIÓN 01",Selected:!0});respuestasMulti.push({RowId:GetUUIDv4(),IdRespuesta:0,Descripcion:"OPCIÓN 02",Selected:!1});respuestasMulti.push({RowId:GetUUIDv4(),IdRespuesta:0,Descripcion:"OPCIÓN 03",Selected:!1});var config={ini:function(){$.ajaxSetup({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:{}})},iniGrids:{GrillaLeccion:function(n){$('.grid-lecciones[data-modulo="'+n+'"]').DataTable({searching:!0,ordering:!1,processing:!0,serverSide:!0,destroy:!0,responsive:!0,autoWidth:!1,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"},ajax:{url:urlListLeccionPaged,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:function(t){var i={};return i.IdModulo=n,JSON.stringify({page:t,request:i})}},columns:[{data:"Tipo",width:"10%"},{data:"Nombre",width:"70%"},{data:"Duracion",sClass:"text-center",width:"10%"},{data:function(n){var t='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Cuestionario.GetRespuesta('+n.IdLeccion+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>',i='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Cuestionario.DeleteRespuesta('+n.IdLeccion+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>';return t+" "+i},sClass:"text-center",width:"10%"}],drawCallback:function(){$('[data-toggle="tooltip1"]').tooltip()}})}}},Cuestionario={SavePregunta:function(){var n={};n.IdPregunta=$("#txtIdPregunta").val();n.IdCuestionario=$("#txtIdCuestionario").val();n.Tipo=$("#ddlPreguntaTipo").val();n.Nombre=$("#txtPreguntaNombre").val();n.Explicacion=$("#txtPreguntaExplicacion").val();n.Ayuda=$("#txtPreguntaAyuda").val();n.Puntaje=$("#txtPreguntPuntaje").val();n.Respuestas=respuestas;DBR.blockUIStar();$.ajax({url:urlSavePregunta,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){DBR.blockUIStop();n.IsSuccess?($("#modalModulo").modal("hide"),DBR.ToastSuccess(n.Message),window.location.reload()):DBR.ToastError(n.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})},GetPregunta:function(n){$("#lblTitleModal").html("Editar");Funciones.LimpiarCamposPregunta();var t={};t.IdPregunta=n;DBR.blockUIStar();$.ajax({url:urlGetPregunta,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();$("#ddlPreguntaTipo").prop("disabled",!0);$("#txtIdPregunta").val(n.IdPregunta);$("#ddlPreguntaTipo").val(n.Tipo);$("#txtPreguntaNombre").val(n.Nombre);$("#txtPreguntaExplicacion").val(n.Explicacion);$("#txtPreguntaAyuda").val(n.Ayuda);$("#txtPreguntPuntaje").val(n.Puntaje);respuestas=[];$.each(n.Respuestas,function(n,t){respuestas.push({RowId:GetUUIDv4(),IdRespuesta:t.IdRespuesta,Descripcion:t.Descripcion,Selected:t.EsCorrecta})});Funciones.CreateTable(n.Tipo,2,respuestas);$("#modalPregunta").modal("show")},error:function(n,t){DBR.blockUIStop();console.log(t)}})},DeletePregunta:function(n){var t={};t.IdPregunta=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeletePregunta,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?(DBR.ToastSuccess(t.Message),window.location.reload()):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},SaveRespuesta:function(){var n={};n.IdLeccion=$("#txtIdLeccion").val();n.IdModulo=$("#txtIdModuloLeccion").val();n.Tipo=$("#ddlTipo").val();n.Nombre=$("#txtLeccionNombre").val();n.Duracion=$("#txtDuracion").val();n.Descripcion=contenidoHtml;n.Url=$("#txtUrlVideo").val();n.Orden=$("#txtOrden").val();DBR.blockUIStar();$.ajax({url:urlSaveLeccion,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(t){DBR.blockUIStop();t.IsSuccess?($('.grid-lecciones[data-modulo="'+n.IdModulo+'"]').DataTable().ajax.reload(),$("#modalLeccion").modal("hide"),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})},GetRespuesta:function(n){$("#lblTitleLeccion").html("Editar");Funciones.LimpiarCamposLeccion();var t={};t.IdLeccion=n;DBR.blockUIStar();$.ajax({url:urlGetLeccion,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();$("#txtIdLeccion").val(n.IdLeccion);$("#ddlTipo").val(n.Tipo);$("#txtLeccionNombre").val(n.Nombre);$("#txtMensajeCompleto").val(n.Descripcion);$("#txtDuracion").val(n.Duracion);$("#txtUrlVideo").val(n.UrlVideo);$("#txtOrden").val(n.Orden);$("#modalLeccion").modal("show")},error:function(n,t){DBR.blockUIStop();console.log(t)}})},DeleteRespuesta:function(n){var t={};t.IdLeccion=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeleteLeccion,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridLeccion").DataTable().ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})}},Funciones={LimpiarCamposPregunta:function(){DBR.limpiarCampo("#ddlPreguntaTipo");DBR.limpiarCampo("#txtPreguntaNombre");DBR.limpiarCampo("#txtPreguntaExplicacion");DBR.limpiarCampo("#txtPreguntaAyuda");DBR.limpiarCampo("#txtPreguntPuntaje");$("#bodyTable").html("")},LimpiarCamposLeccion:function(){DBR.limpiarCampo("#ddlTipo");DBR.limpiarCampo("#txtLeccionNombre");DBR.limpiarCampo("#txtDuracion");DBR.limpiarCampo("#txtMensajeCompleto");DBR.limpiarCampo("#txtUrlVideo");DBR.limpiarCampo("#txtOrden")},CreateTable:function(n,t,i){var r=$('<tr><th width="50">Item<\/th><th width = "270">Respuesta<\/th><th width="150" class="text-center">¿Es opción correcta?<\/th><\/tr>');n==1?($("#headTable").empty(),$("#headTable").append(r),$("#btnAgregarRespuesta").hide(),respuestas=t==1?respuestasTrueFalse:i,Funciones.FillTable(respuestas),$("#tableRespuestas").SetEditable({columnsEd:"1",allowDelete:!1,onEdit:function(n){var t=n[0],i=respuestas.findIndex(n=>n.RowId==$(t).data("rowid"));respuestas[i].Descripcion=t.cells[1].innerText}})):n==2&&($("#headTable").empty(),$("#headTable").append(r),$("#btnAgregarRespuesta").show(),respuestas=t==1?respuestasMulti:i,Funciones.FillTable(respuestas),$("#tableRespuestas").SetEditable({columnsEd:"1",onEdit:function(n){var t=n[0],i=respuestas.findIndex(n=>n.RowId==$(t).data("rowid"));respuestas[i].Descripcion=t.cells[1].innerText},onDelete:function(){},onBeforeDelete:function(n){if(respuestas.length>2){var i=n[0],t=respuestas.findIndex(n=>n.RowId==$(i).data("rowid"));return t>=0&&respuestas.splice(t,1),!0}return DBR.ToastError("No se puede eliminar la respuesta, deben haber como mínimo 2."),!1},onAdd:function(){var n=$("#bodyTable").find("tr:last");let t=0;$("#bodyTable .form-control").each(function(){t++;t==1&&$(this).focus()});t>0&&(DBR.ToastError("Hay respuestas en modo edición, guardelas para poder continuar"),n.remove());n[0].cells[2].innerHTML='<input type="radio" name="chkRespuesta">';n.find("td:nth(2)").find("input").click(function(){for(var t=$(this).closest("tr").data("rowid"),i=respuestas.findIndex(n=>n.RowId==t),n=0;n<respuestas.length;n++)respuestas[n].Selected=n==i?!0:!1});respuestas.push({RowId:n.data("rowid"),IdRespuesta:0,Descripcion:"",Selected:!1});$.each($("#bodyTable").find("tr").find("td:first"),function(n,t){t.innerText=n+1})},$addButton:$("#btnAgregarRespuesta")}));$("input[name=chkRespuesta]").click(function(){for(var t=$(this).closest("tr").data("rowid"),i=respuestas.findIndex(n=>n.RowId==t),n=0;n<respuestas.length;n++)respuestas[n].Selected=n==i?!0:!1})},FillTable:function(n){$("#bodyTable").empty();$.each(n,function(n,t){var i=$('<tr data-id="'+t.IdRespuesta+'" data-rowid="'+t.RowId+'"><td>'+(n+1)+"<\/td><td>"+t.Descripcion+'<\/td><td class="text-center"><input type="radio" name="chkRespuesta" '+(t.Selected?"checked":"")+" /><\/td><\/tr>");$("#bodyTable").append(i)})}};$(document).ready(function(){var n=window.location.origin+"/Mantenimiento/Evento";$("ul.sidebar-menu a").filter(function(){return this.href==n}).parent().siblings().removeClass("active").end().addClass("active");$("ul.treeview-menu a").filter(function(){return this.href==n}).parentsUntil(".sidebar-menu > .treeview-menu").siblings().removeClass("active").end().addClass("active");$.each($(".grid-lecciones"),function(n,t){config.iniGrids.GrillaLeccion($(t).data("modulo"))});$("#txtFecha").datepicker({autoclose:!0,language:"es",format:"dd/mm/yyyy",startDate:new Date});$("#txtPreguntPuntaje").numericInput({allowFloat:!1,allowNegative:!1});$("#btnAgregarPregunta").on("click",function(){$("#lblTitleModal").html("Agregar");$("#txtIdPregunta").val(0);$("#ddlPreguntaTipo").prop("disabled",!1);Funciones.LimpiarCamposPregunta();$("#modalPregunta").modal("show")});$("#ddlPreguntaTipo").change(function(){$("#txtIdPregunta").val()==0&&Funciones.CreateTable($(this).val(),1,[])});$(".btn-edit-pregunta").on("click",function(){var n=$(this).data("pregunta");Cuestionario.GetPregunta(n)});$("#btnGuardarPregunta").on("click",function(){var n=!0;DBR.validarCampo("#txtPreguntaNombre")||(n=!1);DBR.validarCampo("#txtPreguntPuntaje")||(n=!1);n&&($.each(respuestas,function(t,i){if(i.Descripcion==null||i.Descripcion==""){n=!1;DBR.ToastError("Ingrese una descripción a sus respuestas.");return}}),n&&Cuestionario.SavePregunta())});$("button.btn-delete-pregunta").on("click",function(){var n=$(this).data("pregunta");Cuestionario.DeletePregunta(n)});$("#modalPregunta").on("hidden.bs.modal",function(){});$(".btn-agregar-leccion").on("click",function(){$("#lblTitleLeccion").html("Agregar");$("#txtIdModuloLeccion").val($(this).data("modulo"));$("#txtIdLeccion").val(0);Funciones.LimpiarCamposLeccion();$("#modalLeccion").modal("show")});$("#btnGuardarLeccion").on("click",function(){var n=!0;DBR.validarCampo("#ddlTipo")||(n=!1);DBR.validarCampo("#txtLeccionNombre")||(n=!1);DBR.validarCampo("#txtDuracion")||(n=!1);DBR.validarCampo("#txtUrlVideo")||(n=!1);DBR.validarCampo("#txtOrden")||(n=!1);n&&Cuestionario.SaveRespuesta()});$("#modalLeccion").on("shown.bs.modal",function(){var n=CKEDITOR.replace("txtMensajeCompleto",{height:500});n.on("change",function(n){contenidoHtml=n.editor.getData()});n.on("instanceReady",function(n){editor=n.editor;editor.setReadOnly(!1)})})});
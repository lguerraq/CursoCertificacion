var GrillaDocumentos,contenidoHtml="",config={iniGrids:{GrillaDocumentos:function(){GrillaDocumentos=$("#gridDocumentos").DataTable({searching:!1,ordering:!1,processing:!0,serverSide:!0,destroy:!0,responsive:!0,stateSave:!0,paging:!1,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"},ajax:{url:urlListDocumentoPaginado,type:"POST",datatype:"json",contentType:"application/json; charset=UTF-8",data:function(){let n={IdEmpresa:$("#cboEmpresas").val(),IdDocumentoPadre:$("#txtIdDocumentoPadre").val(),Estado:$("#chckVerEliminados").prop("checked")};return JSON.stringify({request:n})}},columns:[{data:function(n){let t="";switch(n.Tipo){case 0:t='<a title="Raíz" onclick="Funciones.VerCarpeta(0)" class="folder-personalizado"><\/i><i class="fa fa-folder fa-folder-open"><\/i> [..Raíz..] \\<\/a>'+n.NombreOriginal+' <i class="fa fa-reply"><\/i>';break;case 1:t='<a title="Abrir" onclick="Funciones.VerCarpeta('+n.IdDocumento+')" class="folder-personalizado"><i class="fa fa-folder"><\/i> '+n.NombreOriginal+"<\/a>";break;case 2:t=n.Extension=="PDF"?'<a class="file-personalizado"><i class="fa fa-file-pdf-o"><\/i> '+n.NombreOriginal+"<\/a>":n.Extension=="DOC"||n.Extension=="DOCX"?'<a class="file-personalizado"><i class="fa fa-file-word-o"><\/i> '+n.NombreOriginal+"<\/a>":n.Extension=="ZIP"?'<a class="file-personalizado"><i class="fa fa-file-zip-o"><\/i> '+n.NombreOriginal+"<\/a>":n.Extension=="XLSX"||n.Extension=="XLS"?'<a class="file-personalizado"><i class="fa fa-file-excel-o"><\/i> '+n.NombreOriginal+"<\/a>":n.Extension=="PPTX"||n.Extension=="PPT"?'<a class="file-personalizado"><i class="fa fa-file-powerpoint-o"><\/i> '+n.NombreOriginal+"<\/a>":n.Extension=="PNG"||n.Extension=="JPG"?'<a class="file-personalizado"><i class="fa fa-file-image-o"><\/i> '+n.NombreOriginal+"<\/a>":'<a class="file-personalizado"><i class="fa fa-file-text-o"><\/i> '+n.NombreOriginal+"<\/a>"}return t},sClass:"text-left"},{data:function(n){return parseJsonDate(n.FechaCreacion)+" "+parseJsonTime(n.FechaCreacion)},sClass:"text-left"},{data:function(n){return parseJsonDate(n.FechaModificacion)+" "+parseJsonTime(n.FechaModificacion)},sClass:"text-left"},{data:function(n){return parseJsonDate(n.FechaDescarga)+" "+parseJsonTime(n.FechaDescarga)},sClass:"text-left"},{data:function(n){return n.Tamaño>0?n.Tamaño>1048576?(n.Tamaño/1048576).toFixed(2)+"Mb":(n.Tamaño/1024).toFixed(2)+"Kb":""},sClass:"text-right"},{data:function(n){return n.Tipo==0?"":n.EstadoDocumento==1?"Pendiente":"Descargado"},sClass:"text-center"},{data:function(n){var i,r;let t;var u='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Eventos.DeleteDocumento('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>',f='<a style="background-color: #dd4b39;border-color: #c52d1a;" data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Eventos.DeleteFisicoDocumento('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>',e='<a style="background-color: #dd4b39;border-color: #c52d1a;" data-toggle="tooltip1" data-placement="bottom" title="Restaurar" onclick="Eventos.RestoreDocumento('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="fa fa-history" aria-hidden="true"><\/span><\/a>';switch(n.Tipo){case 0:t="";break;case 1:i='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Eventos.GetCarpeta('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>';r='<a data-toggle="tooltip1" data-placement="bottom" title="Descargar carpeta" onclick="Eventos.DownloadCarpeta('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="fa fa-cloud-download" aria-hidden="true"><\/span><\/a>';t=n.Estado?r+" "+i+" "+u:f;break;case 2:i='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Eventos.GetDocumento('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>';r='<a data-toggle="tooltip1" data-placement="bottom" title="Descargar documento" onclick="Eventos.DownloadDocumento('+n.IdDocumento+')" class="btn btn-primary btn-xs"><span class="fa fa-cloud-download" aria-hidden="true"><\/span><\/a>';t=n.Estado?r+" "+i+" "+u:e+" "+f}return t},sClass:"text-center"}],createdRow:function(n,t){console.log(t.IdDocumento);t.Tipo==0&&($("td:eq(0)",n).attr("colspan",7),$("td:eq(1)",n).css("display","none"),$("td:eq(2)",n).css("display","none"),$("td:eq(3)",n).css("display","none"),$("td:eq(4)",n).css("display","none"),$("td:eq(5)",n).css("display","none"),$("td:eq(6)",n).css("display","none"),$("td:eq(7)",n).css("display","none"))},drawCallback:function(){$('[data-toggle="tooltip1"]').tooltip({container:"body"})}})}}},Eventos={ListEmpresas:function(){DBR.blockUIStar();$.ajax({url:urlListEmpresaCombo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({}),success:function(n){DBR.blockUIStop();Funciones.LlenarCombo(n.response,"#cboEmpresas",!0,!1,"Seleccione empresa");let t=(n.Tamaño/1048576).toFixed(2)+"Mb / 10Gb";$("#lblConsumo").html(t)},error:function(n,t){console.log(t);DBR.blockUIStop()}})},GetSizeFolder:function(){$.ajax({url:urlGetSizeFolder,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({}),success:function(n){let t=(n/1048576).toFixed(2)+"Mb / 10Gb";$("#lblConsumo").html(t)},error:function(n,t){console.log(t);DBR.blockUIStop()}})},CrearCarpeta:function(){DBR.blockUIStar();let n={IdDocumento:$("#txtIdDocumento1").val(),IdDocumentoPadre:$("#txtIdDocumentoPadre").val(),IdEmpresa:$("#cboEmpresas").val(),Nombre:$("#NombreCarpeta").val()};$.ajax({url:urlSaveCarpeta,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){n.IsSuccess?(DBR.ToastSuccess(n.Message),GrillaDocumentos.ajax.reload(),$("#modalCrearCarpeta").modal("hide")):DBR.ToastError(n.Message);DBR.blockUIStop()},error:function(n,t){console.log(t);DBR.blockUIStop()}})},GetCarpeta:function(n){DBR.blockUIStar();let t={IdDocumento:n};$.ajax({url:urlGetDocumento,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();$("#txtIdDocumento1").val(n.IdDocumento);$("#titleNuevaCarpeta").html("Editar carpeta");DBR.limpiarCampo("#NombreCarpeta");$("#NombreCarpeta").val(n.NombreOriginal);$("#modalCrearCarpeta").modal("show")},error:function(n,t){console.log(t);DBR.blockUIStop()}})},SaveDocumento:function(){var t=document.getElementById("fileDocumento"),n=new FormData;n.append("documento",t.files[0]);n.append("IdDocumento",$("#txtIdDocumento2").val());n.append("IdDocumentoPadre",$("#txtIdDocumentoPadre").val());n.append("IdEmpresa",$("#cboEmpresas").val());DBR.blockUIStar();$.ajax({url:urlSaveDocumento,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){n.IsSuccess?(DBR.ToastSuccess(n.Message),GrillaDocumentos.ajax.reload(),Eventos.GetSizeFolder(),$("#modalDocumento").modal("hide")):DBR.ToastError(n.Message);DBR.blockUIStop()}).fail(function(n){DBR.blockUIStop();console.log(n)})},GetDocumento:function(n){$("#fileDocumento").filestyle("clear");$("#fileDocumento").parent().removeClass("has-error");$("#fileDocumento").next().next().addClass("hide");$("#lblTitleAgregarDocumento").html("Editar documento");$("#txtIdDocumento2").val(n);$("#modalDocumento").modal("show")},DeleteDocumento:function(n){var t={};t.IdDocumento=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeleteDocumento,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?(GrillaDocumentos.ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},DownloadDocumento:function(n){window.location.href=urlDownloadDocumento+"?IdDocumento="+n},DownloadCarpeta:function(n){window.location.href=urlDownloadCarpeta+"?IdDocumento="+n},EnviarCorreo:function(){DBR.blockUIStar("Enviando");let n={Asunto:$("#txtAsuntoMensaje").val(),CorreoOrigen:$("#txtCorreoOrigen").val(),NombreOrigen:$("#txtNombreOrigen").val(),CorreoDestino:$("#txtCorreoDestino").val(),Mensaje:contenidoHtml};$.ajax({url:urlNotificarEmpresaCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){DBR.blockUIStop();n.IsSuccess?(DBR.ToastSuccess(n.Message),GrillaDocumentos.ajax.reload(),$("#modalNotificarCorreo").modal("hide")):DBR.ToastError(n.Message)},error:function(n,t){console.log(t);DBR.blockUIStop()}})},DeleteFisicoDocumento:function(n){var t={};t.IdDocumento=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar permanentemente el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeleteFisicoDocumento,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?(GrillaDocumentos.ajax.reload(),Eventos.GetSizeFolder(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},RestoreDocumento:function(n){var t={};t.IdDocumento=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de restaurar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlRestoreDocumento,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?(GrillaDocumentos.ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},SaveFileServer:function(){var t=document.getElementById("inputFileServer"),n=new FormData;n.append("documento",t.files[0]);DBR.blockUIStar();$.ajax({url:urlSaveFileServer,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){DBR.blockUIStop();$("#inputFileServer").filestyle("clear");n.IsSuccess?$("#txtLink").val(n.Message):($("#txtLink").val(""),GISSAT.ToastError(n.Message))}).fail(function(n){DBR.blockUIStop();console.log(n)})}},Funciones={LlenarCombo:function(n,t,i,r,u){$(t).html("");var f="";u!=null&&u!=undefined&&(f='<option value="0">'+u+"<\/option>");r&&(f="");$.each(n,function(n,t){f=f+'<option data-Informacion="'+t.Informacion+'" value="'+t.Value+'">'+t.Descripcion+"<\/option>"});$(t).html(f);i&&$(t).select2()},VerCarpeta:function(n){$("#txtIdDocumentoPadre").val(n);GrillaDocumentos.ajax.reload()},LimpiarControles:function(){DBR.limpiarCampo("#txtAsuntoMensaje");DBR.limpiarCampo("#txtCorreoOrigen");DBR.limpiarCampo("#txtNombreOrigen");$("#inputFileServer").filestyle("clear");$("#txtLink").val("");CKEDITOR.instances.txtMensajeCompleto.setData("");contenidoHtml=""}};$.fn.SoloLetrasNumerosDatPer=function(){$(this).keydown(function(n){switch(!0){case n.keyCode==186:n.preventDefault();n.stopPropagation();break;case n.keyCode==111:n.preventDefault();break;case n.shiftKey&&n.keyCode==35:n.preventDefault();break;case n.shiftKey&&n.keyCode==36:n.preventDefault();break;case n.shiftKey||n.ctrlKey||n.altKey:n.preventDefault();break;case n.keyCode>=186&&n.keyCode<=187:n.preventDefault();break;case n.keyCode>=193&&n.keyCode<=218:n.preventDefault();break;case n.keyCode>=220:n.preventDefault();break;case n.keyCode==191:n.preventDefault();break;default:var t=n.keyCode;t>=48&&t<=57||t>=96&&t<=105||t>=109&&t<=111||t>=65&&t<=90||t>=8&&t<=9||t>=12&&t<=13||t==32||t==46||t>=35&&t<=40||t==192||t==219||t<=1||n.preventDefault()}})};$(document).ready(function(){$.fn.modal.Constructor.prototype.enforceFocus=function(){};Eventos.ListEmpresas();config.iniGrids.GrillaDocumentos();$("input").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue",increaseArea:"20%"});$("#btnNotificarCorreo").on("click",function(){if(!DBR.validarCampo("#cboEmpresas"))return DBR.ToastWarning("Seleccione una empresa"),!1;Funciones.LimpiarControles();$("#txtCorreoOrigen").val(CorreoOrigen);$("#txtNombreOrigen").val(NombreCorreoOrigen);$("#txtCorreoDestino").val($("#cboEmpresas option:selected").data("informacion"));$("#txtNombreDestino").val($("#cboEmpresas option:selected").text());$("#modalNotificarCorreo").modal("show")});$("#btnAgregarCarpeta").on("click",function(){if(!DBR.validarCampo("#cboEmpresas"))return DBR.ToastWarning("Seleccione una empresa"),!1;$("#titleNuevaCarpeta").html("Nueva carpeta");$("#txtIdDocumento1").val(0);DBR.limpiarCampo("#NombreCarpeta");$("#modalCrearCarpeta").modal("show")});$("#btnCrearCarpeta").on("click",function(){DBR.validarCampo("#NombreCarpeta")&&Eventos.CrearCarpeta()});$("#btnSubirArchivo").on("click",function(){if(!DBR.validarCampo("#cboEmpresas"))return DBR.ToastWarning("Seleccione una empresa"),!1;$("#fileDocumento").filestyle("clear");$("#fileDocumento").parent().removeClass("has-error");$("#fileDocumento").next().next().addClass("hide");$("#lblTitleAgregarDocumento").html("Subir documento");$("#txtIdDocumento2").val(0);$("#modalDocumento").modal("show")});$("#btnGuardarDucumento").on("click",function(){let n=!0;var t=document.getElementById("fileDocumento");t.files.length==0?($("#fileDocumento").parent().addClass("has-error"),$("#fileDocumento").next().next().removeClass("hide"),n=!1):($("#fileDocumento").parent().removeClass("has-error"),$("#fileDocumento").next().next().addClass("hide"),t.files[0].size>10485760&&(DBR.ToastWarning("Verifique que el archivo adjunto no supere el 10MB"),n=!1));n&&Eventos.SaveDocumento()});$("#btnActualizar").on("click",function(){GrillaDocumentos.ajax.reload()});$("#cboEmpresas").on("change",function(){$("#txtIdDocumentoPadre").val(0);GrillaDocumentos.ajax.reload()});$("#chckVerEliminados").on("ifChanged",function(){GrillaDocumentos.ajax.reload()});var n=CKEDITOR.replace("txtMensajeCompleto",{filebrowserBrowseUrl:urlFileServerBrowse,filebrowserUploadUrl:urlSaveFileServerCkEditor});n.on("change",function(n){contenidoHtml=n.editor.getData()});$("#btnGuardarCorreo").on("click",function(){var n=!0;DBR.validarCampo("#txtAsuntoMensaje")||(n=!1);DBR.validarCampo("#txtCorreoOrigen")||(n=!1);DBR.validarCampo("#txtNombreOrigen")||(n=!1);$.trim(contenidoHtml).length==0&&(contenidoHtml="<p><\/p>");n&&Eventos.EnviarCorreo()});$("#inputFileServer").on("change",function(){var n=document.getElementById("inputFileServer");if(n.files.length==0)return GISSAT.ToastWarning("No se selecciono ningún archivo"),!1;if(n.files[0].size>2097152)return GISSAT.ToastWarning("Verifique que el archivo no supere los 2MB"),$("#inputFileServer").filestyle("clear"),$("#txtLink").val(""),!1;Eventos.SaveFileServer()})});
var Enviados=0,Total=0,Contador=0,IniciarValidacion=!1,contenidoHtml="",config={ini:function(){$.ajaxSetup({type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:{}})},iniGrids:{GrillaCorreos:function(){$("#gridCorreo").DataTable({searching:!1,ordering:!1,processing:!0,serverSide:!0,destroy:!0,responsive:!0,stateSave:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"},ajax:{url:urlListCorreoPaged,type:"POST",datatype:"json",data:{}},columns:[{data:function(n){return'<div style="min-width: 200px;white-space: normal;">'+n.Asunto+"<\/div>"},sClass:"text-left"},{data:"Origen",sClass:"text-left"},{data:"NombreOrigen",sClass:"text-left"},{data:function(n){return parseJsonDate(n.FechaEnvio)},sClass:"text-center"},{data:"NumeroEnvio",sClass:"text-center"},{data:"Cantidad",sClass:"text-center"},{data:function(n){var t='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Eventos.GetCorreo('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>',i='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Eventos.DeleteCorreo('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>',r='<a data-toggle="tooltip1" data-placement="bottom" title="Vista previa" onclick="Eventos.VerCorreo('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-eye-open" aria-hidden="true"><\/span><\/a>',u='<a data-toggle="tooltip1" data-placement="bottom" title="Envio masivo" onclick="Eventos.EnviarCorreo('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-envelope" aria-hidden="true"><\/span><\/a>',f='<a data-toggle="tooltip1" data-placement="bottom" title="Enviar faltantes" onclick="Eventos.EnviarCorreoFaltantes('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="fa fa-external-link" aria-hidden="true"><\/span><\/a>',e='<a data-toggle="tooltip1" data-placement="bottom" title="Envio individual" onclick="Eventos.ModalCorreoIndividual('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-share-alt" aria-hidden="true"><\/span><\/a>',o='<a data-toggle="tooltip1" data-placement="bottom" title="Envio profesión" onclick="Eventos.ModalCorreoProfesion('+n.IdCorreo+')" class="btn btn-primary btn-xs"><span class="fa fa-group" aria-hidden="true"><\/span><\/a>';return r+" "+u+" "+f+" "+e+" "+o+" "+t+" "+i},sClass:"text-center"}],drawCallback:function(){$('[data-toggle="tooltip1"]').tooltip({container:"body"})}})}}},Eventos={ValoresIniciales:function(){DBR.blockUIStar();$.ajax({url:urlValoresInicialesCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",success:function(n){DBR.LlenarCombo(n.Profesion,"#cboProfesion",!0,!0,"Seleccione");DBR.blockUIStop()},error:function(n,t){console.log(t)}})},SaveCorreo:function(){var n={};n.IdCorreo=$("#txtIdCorreo").val();n.Asunto=$.trim($("#txtAsuntoMensaje").val().toUpperCase());n.Origen=$.trim($("#txtCorreoOrigen").val().toLowerCase());n.NombreOrigen=$.trim($("#txtNombreOrigen").val().toUpperCase());n.Mensaje=contenidoHtml;DBR.blockUIStar();$.ajax({url:urlSaveCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){DBR.blockUIStop();n.IsSuccess?($("#gridCorreo").DataTable().ajax.reload(),DBR.ToastSuccess(n.Message),$("#modalAgregarCorreo").modal("hide")):DBR.ToastError(n.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})},DeleteCorreo:function(n){var t={};t.IdCorreo=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeleteCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridCorreo").DataTable().ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},GetCorreo:function(n){var t={};t.IdCorreo=n;DBR.blockUIStar();$.ajax({url:urlGetCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();Funciones.LimpiarControlesEditar();$("#txtIdCorreo").val(n.IdCorreo);$("#txtAsuntoMensaje").val(n.Asunto);$("#txtCorreoOrigen").val(n.Origen);$("#txtNombreOrigen").val(n.NombreOrigen);n.Mensaje=n.Mensaje.replace(/div/g,"p");CKEDITOR.instances.txtMensajeCompleto.setData(n.Mensaje);contenidoHtml=n.Mensaje;$("#modalAgregarCorreo").modal("show")},error:function(n,t){DBR.blockUIStop();console.log(t)}})},EnviarCorreo:function(n){var t={};t.IdCorreo=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"Una vez iniciado el envio no podra detenerlo <\/br><\/br> ¿Esta seguro de continuar?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){n.close();$("#modalProcesoEnvio").modal("show");$.ajax({url:urlEnviarCorreoMasivo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),timeout:36e5,success:function(n){$("#modalProcesoEnvio").modal("hide");n.IsSuccess?(DBR.MensajeInformativoSmall(n.Message,"Resultado"),$("#gridCorreo").DataTable().ajax.reload()):DBR.ToastError(n.Message)},error:function(n,t){console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},EnviarCorreoFaltantes:function(n){var t={};t.IdCorreo=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"Una vez iniciado el envio no podra detenerlo <\/br><\/br> ¿Esta seguro de continuar?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){n.close();$("#modalProcesoEnvio").modal("show");$.ajax({url:urlEnviarCorreoMasivoFaltantes,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),timeout:36e5,success:function(n){$("#modalProcesoEnvio").modal("hide");n.IsSuccess?(DBR.MensajeInformativoSmall(n.Message,"Resultado"),$("#gridCorreo").DataTable().ajax.reload()):DBR.ToastError(n.Message)},error:function(n,t){console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},VerCorreo:function(n){var t={};t.IdCorreo=n;DBR.blockUIStar();$.ajax({url:urlGetCorreo,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();$("#mensajePreview").html(n.Mensaje);$("#modalVerCorreo").modal("show")},error:function(n,t){DBR.blockUIStop();console.log(t)}})},SaveFileServer:function(){var t=document.getElementById("inputFileServer"),n=new FormData;n.append("documento",t.files[0]);DBR.blockUIStar();$.ajax({url:urlSaveFileServer,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){DBR.blockUIStop();$("#inputFileServer").filestyle("clear");n.IsSuccess?$("#txtLink").val(n.Message):($("#txtLink").val(""),GISSAT.ToastError(n.Message))}).fail(function(n){DBR.blockUIStop();console.log(n)})},ModalCorreoIndividual:function(n){Funciones.LimpiarControlesPersona();$("#txtIdCorreoEnvioIndividual").val(n);$("#modalEnvioIndividual").modal("show")},ModalCorreoProfesion:function(n){DBR.limpiarCampo("#cboProfesion");$("#txtIdCorreo2").val(n);$("#modalEnvioPorProfesion").modal("show")},EnviarCorreoPorProfesion:function(){var t={},n;t.IdCorreo=$("#txtIdCorreo2").val();n={};n=$("#cboProfesion").val();BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"Una vez iniciado el envio no podra detenerlo <\/br><\/br> ¿Esta seguro de continuar?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(i){i.close();$("#modalProcesoEnvio").modal("show");$.ajax({url:urlEnviarCorreoMasivoPorProfesion,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t,IdsProfesion:n}),timeout:36e5,success:function(n){$("#modalEnvioPorProfesion").modal("hide");$("#modalProcesoEnvio").modal("hide");n.IsSuccess?(DBR.MensajeInformativoSmall(n.Message,"Resultado"),$("#gridCorreo").DataTable().ajax.reload()):DBR.ToastError(n.Message)},error:function(n,t){console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},GetPersona:function(){var n={};n.NumeroDocumento=$("#txtDni").val();$.ajax({url:urlGetPersonaXdni,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){n.length>0?($("#txtNombres").val(n[0].Nombres),$("#txtApellidoPaterno").val(n[0].ApellidoPaterno),$("#txtApellidoMaterno").val(n[0].ApellidoMaterno),$("#txtCip").val(n[0].CIP),$("#txtCorreo").val(n[0].Correo),DBR.ToastSuccess("Persona encontrada")):($("#txtNombres").val(""),$("#txtApellidoPaterno").val(""),$("#txtApellidoMaterno").val(""),$("#txtCip").val(""),$("#txtCorreo").val(""),DBR.ToastWarning("No se encontro persona"))},error:function(n,t){console.log(t)}})},GetPersonaXcip:function(){var n={};n.Cip=$("#txtCip").val();$.ajax({url:urlGetPersonaXcip,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){n.length>0?($("#txtDni").val(n[0].NumeroDocumento),$("#txtNombres").val(n[0].Nombres),$("#txtApellidoPaterno").val(n[0].ApellidoPaterno),$("#txtApellidoMaterno").val(n[0].ApellidoMaterno),$("#txtCip").val(n[0].CIP),$("#txtCorreo").val(n[0].Correo),DBR.ToastSuccess("Persona encontrada")):($("#txtDni").val(""),$("#txtNombres").val(""),$("#txtApellidoPaterno").val(""),$("#txtApellidoMaterno").val(""),$("#txtCorreo").val(""),DBR.ToastWarning("No se encontro persona"))},error:function(n,t){console.log(t)}})},EnviarCorreoIndividual:function(){var t={},n;t.IdCorreo=$("#txtIdCorreoEnvioIndividual").val();n={};n.NumeroDocumento=$.trim($("#txtDni").val());n.Nombres=$.trim($("#txtNombres").val().toUpperCase());n.ApellidoPaterno=$.trim($("#txtApellidoPaterno").val().toUpperCase());n.ApellidoMaterno=$.trim($("#txtApellidoMaterno").val().toUpperCase());n.CIP=$.trim($("#txtCip").val());n.Correo=$.trim($("#txtCorreo").val().toUpperCase());DBR.blockUIStar();$.ajax({url:urlEnviarCorreoIndividual,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t,Persona:n}),success:function(n){DBR.blockUIStop();n.IsSuccess?($("#gridCorreo").DataTable().ajax.reload(null,!1),$("#modalEnvioIndividual").modal("hide"),DBR.ToastSuccess(n.Message)):DBR.ToastError(n.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},Funciones={LimpiarControles:function(){DBR.limpiarCampo("#txtAsuntoMensaje");DBR.limpiarCampo("#txtCorreoOrigen");DBR.limpiarCampo("#txtNombreOrigen");$("#inputFileServer").filestyle("clear");$("#txtLink").val("");CKEDITOR.instances.txtMensajeCompleto.setData("");contenidoHtml=""},LimpiarControlesEditar:function(){DBR.limpiarCampo("#txtAsuntoMensaje");DBR.limpiarCampo("#txtCorreoOrigen");DBR.limpiarCampo("#txtNombreOrigen");$("#inputFileServer").filestyle("clear");$("#txtLink").val("")},LimpiarControlesPersona:function(){$("#formEnviarIndividual .validar").each(function(){DBR.limpiarCampo(this)});$("#txtCip").val("")}};$(document).ready(function(){$.fn.modal.Constructor.prototype.enforceFocus=function(){};config.iniGrids.GrillaCorreos();Eventos.ValoresIniciales();var n=CKEDITOR.replace("txtMensajeCompleto",{height:500,filebrowserBrowseUrl:urlFileServerBrowse,filebrowserUploadUrl:urlSaveFileServerCkEditor});n.on("change",function(n){contenidoHtml=n.editor.getData()});$("#btnAgregarCorreo").on("click",function(){Funciones.LimpiarControles();$("#txtCorreoOrigen").val(CorreoOrigen);$("#txtNombreOrigen").val(NombreCorreoOrigen);$("#modalAgregarCorreo").modal("show")});$("#btnGuardarCorreo").on("click",function(){var n=!0;DBR.validarCampo("#txtAsuntoMensaje")||(n=!1);DBR.validarCampo("#txtCorreoOrigen")||(n=!1);DBR.validarCampo("#txtNombreOrigen")||(n=!1);$.trim(contenidoHtml).length==0&&(contenidoHtml="<p><\/p>");n&&Eventos.SaveCorreo()});$("#inputFileServer").on("change",function(){var n=document.getElementById("inputFileServer");if(n.files.length==0)return GISSAT.ToastWarning("No se selecciono ningún archivo"),!1;if(n.files[0].size>4194304)return GISSAT.ToastWarning("Verifique que el archivo no supere los 4MB"),$("#inputFileServer").filestyle("clear"),$("#txtLink").val(""),!1;Eventos.SaveFileServer()});$("#txtDni").keypress(function(n){n.which==13&&Eventos.GetPersona()});$("#txtCip").keypress(function(n){n.which==13&&Eventos.GetPersonaXcip()});$("#btnBuscarPorDni").on("click",function(){var n=$("#txtDni").val().length;n>=8?Eventos.GetPersona():DBR.ToastWarning("El dni no puede ser menos a 8 dígitos")});$("#btnBuscarPorCip").on("click",function(){var n=$("#txtCip").val().length;n>4?Eventos.GetPersonaXcip():DBR.ToastWarning("El CIP no puede ser menos a 4 dígitos")});$("#btnEnviarIndividual").on("click",function(){var n=!0;$("#formEnviarIndividual .validar").each(function(){DBR.validarCampo(this)||(n=!1)});$.trim($("#txtDni").val())!=""&&$.trim($("#txtDni").val()).length<8&&(DBR.ToastWarning("El dni no puede ser menos a 8 dígitos"),n=!1);n&&Eventos.EnviarCorreoIndividual()});$("#btnEnviarPorProfesion").on("click",function(){DBR.validarCampo("#cboProfesion")&&Eventos.EnviarCorreoPorProfesion()})});
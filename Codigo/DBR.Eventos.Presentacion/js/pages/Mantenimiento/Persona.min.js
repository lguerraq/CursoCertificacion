var config={iniGrids:{GrillaPersonas:function(){$("#gridPersonas").DataTable({searching:!0,ordering:!1,processing:!0,serverSide:!0,destroy:!0,stateSave:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"},ajax:{url:UrlListPersonaPaged,type:"POST",datatype:"json",data:{}},columns:[{data:"ApellidoPaterno"},{data:"ApellidoMaterno"},{data:"Nombres"},{data:"NumeroDocumento"},{data:"Celular"},{data:"Correo"},{data:"CIP"},{data:"TipoOcupacionNombre"},{data:function(n){var t='<a data-toggle="tooltip1" data-placement="bottom" title="Editar evento" onclick="Eventos.GetPersona('+n.IdPersona+",'"+n.NumeroDocumento+"','"+n.CIP+"','"+n.Nombres+"','"+n.ApellidoPaterno+"','"+n.ApellidoMaterno+"','"+n.Celular+"','"+n.Correo+"',"+n.TipoOcupacion+",'"+n.DescripcionOcupacion+"',"+n.IdProfesion+","+n.IdPais+",'"+n.Ciudad+'\')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>',i='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar evento" onclick="Eventos.DeletePersona('+n.IdPersona+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>';return t+" "+i},sClass:"text-center"}],drawCallback:function(){$('[data-toggle="tooltip1"]').tooltip()}})}}},Eventos={ValoresInicialesPersona:function(){$.ajax({url:UrlValoresInicialesPersona,type:"POST",dataType:"json",success:function(n){DBR.LlenarCombo(n.Ocupacion,"#cboTipoOcupacion",!1,!1,"Seleccione");DBR.LlenarCombo(n.Profesion,"#cboProfesion",!1,!1,"Seleccione");DBR.LlenarCombo(n.Pais,"#cboPais",!0,!1,"Seleccione")},error:function(n,t){console.log(t)}})},SavePersona:function(){var n={};n.IdPersona=$("#txtIdPersona").val();n.Nombres=$.trim($("#txtNombres").val().toUpperCase());n.ApellidoPaterno=$.trim($("#txtApellidoPaterno").val().toUpperCase());n.ApellidoMaterno=$.trim($("#txtApellidoMaterno").val().toUpperCase());n.NumeroDocumento=$.trim($("#txtDni").val());n.TipoOcupacion=$("#cboTipoOcupacion").val();n.CIP=$.trim($("#txtCip").val());n.Celular=$.trim($("#txtCelular").val());n.Correo=$.trim($("#txtCorreo").val().toUpperCase());n.DescripcionOcupacion=$.trim($("#txtDescripcionOcupacion").val().toUpperCase());n.IdProfesion=$("#cboProfesion").val();n.IdPais=$("#cboPais").val();n.Ciudad=$.trim($("#txtCiudad").val().toUpperCase());DBR.blockUIStar();$.ajax({url:UrlSavePersona,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:n}),success:function(n){DBR.blockUIStop();n.IsSuccess?($("#gridPersonas").DataTable().ajax.reload(null,!1),$("#modalPersona").modal("hide"),DBR.ToastSuccess(n.Message)):DBR.ToastError(n.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})},GetPersona:function(n,t,i,r,u,f,e,o,s,h,c,l,a){Funciones.LimpiarCamposPersona();$("#lblTitleAgregarPersona").html("Editar");$("#txtIdPersona").val(n);$("#txtNombres").val(r);$("#txtApellidoPaterno").val(u);$("#txtApellidoMaterno").val(f);$("#txtDni").val(t);$("#cboTipoOcupacion").val(s);i!="null"&&$("#txtCip").val(i);$("#txtCelular").val(e);$("#txtCorreo").val(o);h!="null"&&$("#txtDescripcionOcupacion").val(h);c!=null&&$("#cboProfesion").val(c).trigger("change");l!=null&&$("#cboPais").val(l).trigger("change");a!="null"&&$("#txtCiudad").val(a);$("#modalPersona").modal("show")},DeletePersona:function(n){var t={};t.IdPersona=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:UrlDeletePersona,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridPersonas").DataTable().ajax.reload(null,!1),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},SavePersonaMasiva:function(){var t=document.getElementById("filePlantilla"),n=new FormData;n.append("documento",t.files[0]);DBR.blockUIStar();$.ajax({url:UrlSavePersonaMasivo,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){if(DBR.blockUIStop(),n.IsSuccess){$("#filePlantilla").filestyle("clear");$("#modalCargaMasiva").modal("hide");n.Codigo==1?($("#gridPersonas").DataTable().ajax.reload(null,!1),DBR.ToastSuccess(n.Message)):DBR.MensajeInformativoNormal(n.Message+'\n<a class="btn btn-default btn-sm" onclick="Eventos.DescargarPlanillaErrores()" style="cursor:pointer;"><i class="fa fa-cloud-download"><\/i> Planilla con errores<\/a>',"Resultado de validación")}else DBR.ToastError(n.Message)}).fail(function(n){DBR.blockUIStop();console.log(n)})},DescargarPlanillaErrores:function(){window.location.href=UrlDescargarPlantillaErrores}},Funciones={LimpiarCamposPersona:function(){$("#formPersona .validar").each(function(){DBR.limpiarCampo(this)});$("#txtCip").val("");$("#txtDescripcionOcupacion").val("");$("#txtCiudad").val("")}};$(document).ready(function(){Eventos.ValoresInicialesPersona();config.iniGrids.GrillaPersonas();$("#txtDni").numericInput({allowFloat:!1,allowNegative:!1});$("#txtCelular").numericInput({allowFloat:!1,allowNegative:!1});$("#txtCip").numericInput({allowFloat:!1,allowNegative:!1});$("#cboProfesion").select2();$("#btnAgregarPersona").on("click",function(){Funciones.LimpiarCamposPersona();$("#txtIdPersona").val(0);$("#lblTitleAgregarPersona").html("Agregar");$("#modalPersona").modal("show")});$("#btnGuardarPersona").on("click",function(){var n=!0;$("#formPersona .validar").each(function(){DBR.validarCampo(this)||(n=!1)});$.trim($("#txtDni").val())!=""&&$.trim($("#txtDni").val()).length<8&&(DBR.ToastWarning("El dni no puede ser menos a 8 dígitos"),n=!1);n&&Eventos.SavePersona()});$("#btnAgregarCargaMasiva").on("click",function(){$("#filePlantilla").filestyle("clear");$("#filePlantilla").parent().removeClass("has-error");$("#filePlantilla").next().next().addClass("hide");$("#modalCargaMasiva").modal("show")});$("#btnGuardarCargaMasiva").on("click",function(){var n=!0,t=document.getElementById("filePlantilla");t.files.length==0?($("#filePlantilla").parent().addClass("has-error"),$("#filePlantilla").next().next().removeClass("hide"),n=!1):($("#filePlantilla").parent().removeClass("has-error"),$("#filePlantilla").next().next().addClass("hide"),t.files[0].size>4194304&&(DBR.ToastWarning("Verifique que el archivo adjunto no supere el 4MB"),n=!1));n&&Eventos.SavePersonaMasiva()})});
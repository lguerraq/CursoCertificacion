var EditarDocumento1=!1,config={iniGrids:{GrillaSuceso:function(){$("#gridSucesos").DataTable({searching:!0,ordering:!1,processing:!0,serverSide:!0,destroy:!0,responsive:!0,stateSave:!0,language:{url:"//cdn.datatables.net/plug-ins/1.10.15/i18n/Spanish.json"},ajax:{url:urlListSucesoPaginado,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",datatype:"json",data:function(n){return JSON.stringify({page1:n})}},columns:[{data:function(n){return'<div class="ClBodyNombreSuceso" title="'+n.NombreSuceso+'" style="max-width:400px; overflow:hidden;white-space:nowrap;text-overflow: ellipsis;">'+n.NombreSuceso+"<\/div>"},bSortable:!1,sClass:"text-left",width:"50%"},{data:function(n){return parseJsonDate(n.Fecha)},bSortable:!1,sClass:"text-center",width:"15%"},{data:function(n){return n.Activo?"SI":"NO"},sClass:"text-center",width:"10%"},{data:function(n,t,i,r){return'<a href="'+urlDescargaDocumentos+n.ImagenSuceso+'" target="_blank">FOTO'+(r.row+1)+".JPG<\/a>"},sClass:"text-center",width:"10%"},{data:function(n,t,i,r){var e='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Eventos.GetSuceso('+n.IdSuceso+","+(r.row+1)+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>',o='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Eventos.DeleteSuceso('+n.IdSuceso+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>',u='<a data-toggle="tooltip1" data-placement="bottom" title="Activar" onclick="Eventos.UpdateEstadoSuceso('+n.IdSuceso+',1)" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-ok" aria-hidden="true"><\/span><\/a>',f='<a data-toggle="tooltip1" data-placement="bottom" title="Desactivar" onclick="Eventos.UpdateEstadoSuceso('+n.IdSuceso+',0)" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-remove" aria-hidden="true"><\/span><\/a>';return n.Activo?u="":f="",e+" "+o+" "+u+" "+f},sClass:"text-center",width:"15%"}],drawCallback:function(){$(".ClBodyNombreSuceso").css("max-width",$(".ClNombreSuceso").width());$('[data-toggle="tooltip1"]').tooltip({container:"body"})}})}}},Eventos={SaveSuceso:function(){var t=document.getElementById("fileFoto"),n=new FormData;n.append("documento1",t.files[0]);n.append("IdSuceso",$("#txtIdSuceso").val());n.append("NombreSuceso",$("#txtNombreSuceso").val());n.append("Descripcion",$("#txtDescripcion").val());n.append("Fecha",$("#txtFecha").val());n.append("Horas",$("#txtHoras").val());DBR.blockUIStar();$.ajax({url:urlSaveSuceso,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){DBR.blockUIStop();n.IsSuccess?($("#gridSucesos").DataTable().ajax.reload(),$("#modalSuceso").modal("hide"),DBR.ToastSuccess(n.Message)):DBR.ToastError(n.Message)}).fail(function(n){DBR.blockUIStop();console.log(n)})},GetSuceso:function(n,t){$("#lblTitleAgregarSuceso").html("Editar");Funciones.LimpiarCamposSuceso();var i={};i.IdSuceso=n;DBR.blockUIStar();$.ajax({url:urlGetSuceso,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:i}),success:function(n){DBR.blockUIStop();$("#txtIdSuceso").val(n.IdSuceso);$("#ddlTipo").val(n.Tipo);$("#txtNombreSuceso").val(n.NombreSuceso);$("#txtDescripcion").val(n.Descripcion);$("#txtFecha").val(parseJsonDate(n.Fecha));$("#txtHoras").val(n.Horas);$($("#fileFoto").next().children()[0]).val("FOTO"+t+".PDF");EditarDocumento1=!1;$("#cboTema").val(n.IdsTemas).trigger("change");$("#modalSuceso").modal("show")},error:function(n,t){DBR.blockUIStop();console.log(t)}})},DeleteSuceso:function(n){var t={};t.IdSuceso=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeleteSuceso,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridSucesos").DataTable().ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})},UpdateEstadoSuceso:function(n,t){var i={};i.IdSuceso=n;i.Activo=t;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de cambiar el estado del registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urUpdateEstadoSuceso,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:i}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridSucesos").DataTable().ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})}},Funciones={LimpiarCamposSuceso:function(){$("#fileFoto").filestyle("clear");$("#fileFoto").parent().removeClass("has-error");$("#fileFoto").next().next().addClass("hide");DBR.limpiarCampo("#txtDescripcion");DBR.limpiarCampo("#txtNombreSuceso");DBR.limpiarCampo("#txtFecha");DBR.limpiarCampo("#txtHoras")}};$(document).ready(function(){config.iniGrids.GrillaSuceso();$("#txtFecha").datepicker({autoclose:!0,language:"es",format:"dd/mm/yyyy"});$("#txtHoras").numericInput({allowFloat:!1,allowNegative:!1});var n=window.URL||window.webkitURL;$("#fileFoto").on("change",function(){var t,i,r,u;EditarDocumento1=!0;(i=this.files[0])&&(r=this.files[0].size,u=parseInt(r/1024),t=new Image,t.onload=function(){u>1024&&(DBR.ToastWarning("Verifique que la foto adjunta no supere el 1MB"),$("#fileFoto").filestyle("clear"));(this.width!==780||this.height!=450)&&(DBR.ToastWarning("Verifique que la foto compla con las dimenciones ancho: 780px y alto:450px"),$("#fileFoto").filestyle("clear"))},t.src=n.createObjectURL(i))});$("#btnAgregarSuceso").on("click",function(){EditarDocumento1=!0;$("#lblTitleAgregarSuceso").html("Agregar");Funciones.LimpiarCamposSuceso();$("#modalSuceso").modal("show")});$("#btnGuardarSuceso").on("click",function(){var n=!0,t;DBR.validarCampo("#txtNombreSuceso")||(n=!1);DBR.validarCampo("#txtDescripcion")||(n=!1);DBR.validarCampo("#txtFecha")||(n=!1);DBR.validarCampo("#txtHoras")||(n=!1);EditarDocumento1&&(t=document.getElementById("fileFoto"),t.files.length==0?($("#fileFoto").parent().addClass("has-error"),$("#fileFoto").next().next().removeClass("hide"),n=!1):($("#fileFoto").parent().removeClass("has-error"),$("#fileFoto").next().next().addClass("hide"),t.files[0].size>3145728&&(DBR.ToastWarning("Verifique que el archivo adjunto no supere el 1MB"),n=!1)));n&&Eventos.SaveSuceso()})});
var NombreImagen,image=document.getElementById("imgPreview"),cropBoxData,canvasData,cropper,Eventos={SavePortada:function(){var t=document.getElementById("fileFoto"),n=new FormData;HabilitarValidacionDoc?(n.append("documento",t.files[0]),n.append("NombreImagen",t.files[0].name)):n.append("NombreImagen",NombreImagen);cropBoxData=cropper.getCropBoxData();canvasData=cropper.getCanvasData();n.append("IdPortada",$("#txtIdPortada").val());n.append("Descripcion",$("#txtDescripcion").val());n.append("SubTitulo1",$("#txtSubTitulo1").val());n.append("SubTitulo2",$("#txtSubTitulo2").val());n.append("TextoEnlace",$("#txtTextoEnlace").val());n.append("UrlEnlace",$("#txtUrlEnlace").val());n.append("left",cropBoxData.left);n.append("top",cropBoxData.top);n.append("width",cropBoxData.width);n.append("height",cropBoxData.height);n.append("widthCropper",canvasData.width);n.append("heightCropper",canvasData.height);n.append("naturalWidth",canvasData.naturalWidth);n.append("naturalHeight",canvasData.naturalHeight);DBR.blockUIStar();$.ajax({url:urlSavePortada,type:"POST",dataType:"json",cache:!1,contentType:!1,processData:!1,data:n}).done(function(n){DBR.blockUIStop();n.IsSuccess?($("#gridPortada").DataTable().ajax.reload(),$("#modalPortada").modal("hide"),DBR.ToastSuccess(n.Message)):DBR.ToastError(n.Message)}).fail(function(n){DBR.blockUIStop();console.log(n)})},GetPortada:function(n){var t={};t.IdPortada=n;DBR.blockUIStar();$.ajax({url:urlGetPortada,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(n){DBR.blockUIStop();Funciones.LimpiarCaposPortada();$("#txtIdPortada").val(n.IdPortada);$($("#fileFoto").next().children()[0]).val(n.NombreImagen);$("#txtDescripcion").val(n.Descripcion);$("#txtSubTitulo1").val(n.SubTitulo1);$("#txtSubTitulo2").val(n.SubTitulo2);n.TextoEnlace==null?$("#ckIncluirEnlance").iCheck("uncheck"):$("#ckIncluirEnlance").iCheck("check");$("#txtTextoEnlace").val(n.TextoEnlace);$("#txtUrlEnlace").val(n.UrlEnlace);$("#imgPreview").attr("src",urlCarpetaGaleria+n.NombreImagen);NombreImagen=n.NombreImagen;HabilitarValidacionDoc=!1;$("#imgPreview").show();$("#modalPortada").modal("show")},error:function(n){$(".gifLoadingGeneral").hide();console.log(n)}})},GetFoto:function(n){$("#viewFoto").attr("src",urlCarpetaGaleria+n);$("#modalVerImagen").modal("show")},DeletePortada:function(n){var t={};t.IdPortada=n;BootstrapDialog.show({title:"Confirmación",closeByBackdrop:!1,message:"¿Esta seguro de eliminar el registro?",size:BootstrapDialog.SIZE_SMALL,buttons:[{label:"Si",cssClass:"btn-primary btn-sm",action:function(n){DBR.blockUIStar();$.ajax({url:urlDeletePortada,type:"POST",contentType:"application/json; charset=utf-8",dataType:"json",data:JSON.stringify({request:t}),success:function(t){DBR.blockUIStop();n.close();t.IsSuccess?($("#gridPortada").DataTable().ajax.reload(),DBR.ToastSuccess(t.Message)):DBR.ToastError(t.Message)},error:function(n,t){DBR.blockUIStop();console.log(t)}})}},{label:"No",cssClass:"btn-default btn-sm",action:function(n){n.close()}}]})}},Funciones={LimpiarCaposPortada:function(){$("#imgPreview").hide();$("#imgPreview").attr("src","");$("#fileFoto").filestyle("clear");$("#fileFoto").parent().removeClass("has-error");$("#fileFoto").next().next().addClass("hide");DBR.limpiarCampo("#txtDescripcion");$("#ckIncluirEnlance").iCheck("uncheck")}},Grilla={GrillaPortada:function(){$("#gridPortada").DataTable({searching:!0,ordering:!1,processing:!0,serverSide:!0,destroy:!0,responsive:!0,language:setIdiomaSpanish,ajax:{url:urlListPortadaPaginado,type:"POST",contentType:"application/json; charset=utf-8",datatype:"JSON",data:function(n){return n.order="ASC",JSON.stringify({page:n})}},columns:[{data:"NombreImagen"},{data:"Descripcion"},{data:function(n){return'<a data-toggle="tooltip1" data-placement="bottom" title="Ver imagen" onclick="Eventos.GetFoto(\''+n.NombreImagen+'\')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-picture" aria-hidden="true"><\/span><\/a>'},sClass:"text-center"},{data:function(n){var t='<a data-toggle="tooltip1" data-placement="bottom" title="Editar" onclick="Eventos.GetPortada('+n.IdPortada+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-pencil" aria-hidden="true"><\/span><\/a>',i='<a data-toggle="tooltip1" data-placement="bottom" title="Eliminar" onclick="Eventos.DeletePortada('+n.IdPortada+')" class="btn btn-primary btn-xs"><span class="glyphicon glyphicon-trash" aria-hidden="true"><\/span><\/a>';return t+" "+i},sClass:"text-center"}],drawCallback:function(){$('[data-toggle="tooltip1"]').tooltip({container:"body"})}})}};$(document).ready(function(){function n(n){var r=n.target.files[0],i;if(!r.type.match(/image.*/)){$("#imgPreview").hide();return}i=new FileReader;i.onload=t;i.readAsDataURL(r)}function t(n){var t=n.target.result;$("#imgPreview").attr("src",t);$("#imgPreview").fadeIn();cropper.destroy();cropper=null;image=document.getElementById("imgPreview");cropper=new Cropper(image,{autoCropArea:1,viewMode:2,zoomable:!1,aspectRatio:widthCropper/heightCropper,ready:function(){cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData)}})}Grilla.GrillaPortada();$(".minimal").iCheck({checkboxClass:"icheckbox_square-blue",radioClass:"iradio_square-blue"});$("#btnAgregarPortada").on("click",function(){Funciones.LimpiarCaposPortada();$("#txtIdPortada").val(0);HabilitarValidacionDoc=!0;$("#modalPortada").modal("show")});$("#btnGuardarPortada").on("click",function(){var i=document.getElementById("fileFoto"),n=!0;if(DBR.validarCampo("#txtDescripcion")||(n=!1),HabilitarValidacionDoc)if(i.files.length==0)$("#fileFoto").parent().addClass("has-error"),$("#fileFoto").next().next().removeClass("hide"),n=!1;else{$("#fileFoto").parent().removeClass("has-error");$("#fileFoto").next().next().addClass("hide");var r=i.files[0].name,t=r.substr(r.lastIndexOf(".")+1);t=t.toUpperCase();"JPG,PNG,JPEG".indexOf(t)<0?($("#fileFoto").parent().addClass("has-error"),DBR.ToastError("Hay archivos no permitidos"),n=!1):$("#fileFoto").parent().removeClass("has-error")}$("#ckIncluirEnlance").prop("checked")&&(DBR.validarCampo("#txtTextoEnlace")||(n=!1),DBR.validarCampo("#txtUrlEnlace")||(n=!1));n&&Eventos.SavePortada()});$("#ckIncluirEnlance").on("ifChanged",function(){$(this).prop("checked")?($("#containerTexto").removeClass("hide"),$("#containerUrl").removeClass("hide")):($("#containerTexto").addClass("hide"),$("#containerUrl").addClass("hide"));DBR.limpiarCampo("#txtTextoEnlace");DBR.limpiarCampo("#txtUrlEnlace")});$("#fileFoto").change(function(t){var r,i,u;if(HabilitarValidacionDoc=!0,t.target.files.length==0)return $("#fileFoto").filestyle("clear"),$("#imgPreview").hide(),$("#imgPreview").attr("src",""),!1;if(r=t.target.files[0].name,i=r.substr(r.lastIndexOf(".")+1),i=i.toUpperCase(),u="JPG,JPEG,PNG",u.indexOf(i)<0)return $("#fileFoto").filestyle("clear"),$("#imgPreview").hide(),$("#imgPreview").attr("src",""),DBR.ToastError("Archivo no permitido."),!1;if(t.target.files[0].size>524288)return $("#fileFoto").filestyle("clear"),$("#imgPreview").hide(),$("#imgPreview").attr("src",""),DBR.ToastError("El archivo supera el limite de 0.5Mb permitido"),!1;n(t)})});window.addEventListener("DOMContentLoaded",function(){$("#modalPortada").on("shown.bs.modal",function(){cropper=new Cropper(image,{autoCropArea:1,viewMode:2,zoomable:!1,aspectRatio:widthCropper/heightCropper,ready:function(){cropper.setCropBoxData(cropBoxData).setCanvasData(canvasData)}})}).on("hidden.bs.modal",function(){cropBoxData=cropper.getCropBoxData();canvasData=cropper.getCanvasData();cropper.destroy();cropper=null})});